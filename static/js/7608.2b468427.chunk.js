"use strict";(self.webpackChunkPPCV_frontend=self.webpackChunkPPCV_frontend||[]).push([[7608],{87608:(e,t,a)=>{a.r(t),a.d(t,{MapPage:()=>en});var n=a(9950),i=a(36742),l=a(57757),s=a(40485),r=a(95590),o=a(23151),c=a(34141);const d=e=>({display:"flex",flexDirection:"column",width:"100vw",alighItems:"stretch",marginTop:0,height:"100%","& .leaflet-bottom .leaflet-bar-timecontrol":{flexWrap:"nowrap",mb:3,"&>.timecontrol-date":{minWidth:"fit-content",width:"auto",pt:0,pb:0,pl:2.5,pr:2.5,"&:hover":{position:"static",minWidth:"fit-content",width:"auto",pt:0,pb:0,pl:2.5,pr:2.5,whiteSpace:"nowrap"},[e.breakpoints.down("def")]:{pl:1,pr:1,"&:hover":{pl:1,pr:1}}},"& .timecontrol-dateslider .slider":{[e.breakpoints.down("def")]:{width:"110px"}}}}),p=e=>({height:"100%",width:"100%",display:"flex",justifyContent:"center",alignItems:"center"});var m=a(99810),u=a(37119),x=a(31904),h=a(86800),g=a(49029),f=a(2527),y=a.n(f),v=a(17119),b=a(44414);const j=e=>{const t=e.latlng.wrap();return(0,b.jsx)(n.Fragment,{children:(0,b.jsxs)("small",{children:[t.lat," ",t.lng]})})},_=e=>{const[t,a]=n.useState(new(y().LatLng)(0,0));return e.map.on({mousemove:e=>{a(e.latlng)},click:t=>{a(t.latlng),e.onClick(t.latlng)}}),(0,b.jsx)(e.control,{latlng:t})};class A extends y().Control{constructor(e){var t;super(e),this._div=void 0,this.control=void 0,this.onClick=void 0,this.onAdd=e=>(this._div=y().DomUtil.create("div",""),v.render((0,b.jsx)(_,{map:e,control:this.control,onClick:this.onClick}),this._div),this._div),this.onRemove=()=>{},this._div=null,this.control=(null===e||void 0===e?void 0:e.customComponent)||j,this.onClick=null!==(t=null===e||void 0===e?void 0:e.onClick)&&void 0!==t?t:e=>{}}}L.MousePosition=A;var w=a(56459);const S=(0,w.T7)((function(e){return new A(e)}));var C=a(35658),k=a(67174),D=a(82223),M=a(41834),T=a(7088),I=a(27081),R=a(98007),F=a(3388),O=a(13415),N=a(73675),z=a(82387),B=a(98522);const E="https://clima.arpa.veneto.it/backend/",P="https://clima.arpa.veneto.it";var W=a(49211);const V=e=>W.A.get(e);class Z{constructor(e){this.instance=void 0,this._initializeResponseInterceptor=()=>{this.instance.interceptors.response.use(this._handleResponse,this._handleError)},this._handleResponse=e=>{let{data:t}=e;return t},this._handleError=e=>{var t,a,n,i;return 401===(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.status)&&"Unauthenticated."===(null===e||void 0===e||null===(a=e.response)||void 0===a||null===(n=a.data)||void 0===n?void 0:n.message)&&V("AuthToken")&&(i="AuthToken",W.A.remove(i),window&&window.location.reload()),Promise.reject(e)},this.instance=B.Ay.create(e),this._initializeResponseInterceptor()}}const H={baseURL:E};class q extends Z{constructor(){super(H),this._initializeRequestInterceptor=()=>{this.instance.interceptors.request.use(this._handleRequest,this._handleError)},this._handleRequest=e=>{const t=V("AuthToken");return"string"===typeof t&&(e.headers.Authorization="Bearer ".concat(t)),e},this._initializeRequestInterceptor()}}class G extends q{constructor(){var e;super(...arguments),e=this,this.getLayers=()=>this.instance.get("/maps/maps/"),this.getCities=()=>this.instance.get("/places/cities/"),this.getTimeserie=function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:45.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:11;return e.instance.get("/maps/ncss/timeserie/?id=".concat(t,"&latitude=").concat(a,"&longitude=").concat(n))},this.getTimeseries=function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:45.5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:11;return e.instance.get("/maps/ncss/timeserie/?ids=".concat(t.join(","),"&latitude=").concat(a.toFixed(4),"&longitude=").concat(n.toFixed(4)))},this.downloadTimeseries=e=>this.instance.post("/maps/ncss/timeserie/",e,{responseType:"blob"}),this.getNetcdf=e=>this.instance.post("/maps/ncss/netcdf/",e,{responseType:"blob"}),this.getForecastAttribute=function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.instance.get("/forcastattributes/".concat(t,"/"),{params:a})}}static getInstance(){return this.classInstance||(this.classInstance=new G),this.classInstance}}function*J(){const e=G.getInstance();try{const t=(yield(0,z.Q7)(Q.map((t=>(0,z.T1)(e.getForecastAttribute,t))))).map((e=>e.results));yield(0,z.yJ)(ne.parametersLoaded(t))}catch(t){console.log(t),yield(0,z.yJ)(ne.genericError({error:"app.error.dlParameters"}))}}function*U(){const e=G.getInstance();try{const t=yield(0,z.T1)(e.getLayers);yield(0,z.yJ)(ne.layerLoaded(t.results))}catch(t){console.log(t),yield(0,z.yJ)(ne.genericError({error:"app.error.dlParameters"}))}}function*Y(){const e=G.getInstance();try{const t=yield(0,z.T1)(e.getCities);yield(0,z.yJ)(ne.citiesLoaded(t.results))}catch(t){console.log(t),yield(0,z.yJ)(ne.genericError({error:"app.error.dlCities"}))}}function*$(e){const{id:t,lat:a,lng:n}=e.payload,i=G.getInstance();try{const e=yield(0,z.T1)(i.getTimeserie,t,a,n);yield(0,z.yJ)(ne.setTimeserie(e.results))}catch(l){console.log(l),yield(0,z.yJ)(ne.genericError({error:"app.error.dlTimeSeries"}))}}function*K(){yield(0,z.p8)(ne.loadParameters.type,J),yield(0,z.p8)(ne.loadLayers.type,U),yield(0,z.p8)(ne.loadCities.type,Y),yield(0,z.p8)(ne.requestTimeserie.type,$)}G.classInstance=void 0;const Q=["variables","forecast_models","scenarios","data_series","year_periods","time_windows","value_types"],X=["variable","forecast_model","scenario","data_series","year_period","value_type"],ee=["variable","forecast_model","scenario","data_series","year_period","value_type","time_window"],te={selected_map:{variable_id:"TAS",forecast_model_id:"ens5",scenario_id:"Rcp85",data_series_id:"no",year_period_id:"djf",time_window_id:"tw1",value_type_id:"anomaly",time_start:"2050-02-28T12:00:00Z",time_end:"2050-02-28T12:00:00Z",time_interval:null,csr:"CRS:84",layer_id:"tas",path:"ensembletwbc/tas_avg_anom_tw1\u202685_DJF.nc",palette:"seq-YlOrRd",unit:"K",color_scale_min:272,color_scale_max:280,bbox:[[14.2,10],[47.3,44.4]],elevation:2,legend:"/thredds/wms/ensembletwbc/tas_avg_anom_tw1\u202685_DJF.nc?REQUEST=GetLegendGraphic&numcolorbands=100&LAYERS=tas&STYLES=default-scalar%2Fseq-YlOrRd",spatialbounds:{type:"Polygon",coordinates:[[[10.050000388447831,44.49987030029297],[10.050000388447831,47.39982604980469],[14.249999802287032,47.39982604980469],[14.249999802287032,44.49987030029297],[10.050000388447831,44.49987030029297]]]},variable:"TAS",forecast_model:"ens5",scenario:"Rcp85",data_series:"no",year_period:"djf",time_window:"tw1",value_type:"anomaly"},timeserie:[],selectactable_parameters:{variables:[],forecast_models:[],scenarios:[],data_series:[],year_periods:[],time_windows:[],value_types:[]},forecast_parameters:{variables:[],forecast_models:[],scenarios:[],data_series:[],year_periods:[],time_windows:[],value_types:[]},opacity:.85,layers:[],cities:[],city:null,loading:!1,error:null},ae=(0,O.Z)({name:"map",initialState:te,reducers:{someAction(e,t){},loadParameters(e){e.loading=!0,e.error=null},loadLayers(e){e.loading=!0,e.error=null},loadCities(e){e.loading=!0,e.error=null},citiesLoaded(e,t){e.loading=!1,e.error=null,e.cities=t.payload.map((e=>({...e,label:e.name})))},parametersLoaded:function(e,t){const[a,n,i,l,s,r,o]=t.payload;e.forecast_parameters={variables:a,forecast_models:n,scenarios:i,data_series:l,year_periods:s,time_windows:r,value_types:o},e.loading=!1},layerLoaded:function(e,t){e.layers=t.payload,e.loading=!1,e.selectactable_parameters=re(e)[0]},genericError(e,t){e.error=t.payload.error,e.loading=!1},setMap(e,t){const a=Object.fromEntries(Object.entries(t.payload).filter((e=>{let[t]=e;return ee.includes(t)}))),n=se(JSON.parse(JSON.stringify(e.layers)),a);n.length>0&&(e.selected_map=n[0],1===n.length&&(e.selectactable_parameters=re(e)[0]))},changeSelection(e,t){e.selected_map.id=null;const{key:a,value:n}=t.payload;e.selected_map[t.payload.key]=t.payload.value,"yes"===e.selected_map.data_series&&(e.selected_map.time_window=null);const[i,l]=re(e);e.selectactable_parameters=i,e.selected_map=l;const s=Object.fromEntries(Object.entries(l).filter((e=>{let[t]=e;return ee.includes(t)}))),r=se(JSON.parse(JSON.stringify(e.layers)),s);r.length>0?1===r.length?(console.log("found"),e.selected_map=r[0]):(console.log("More than one layer found"),e.selected_map=s):console.log("No layer found"),e.loading=!1},requestTimeserie(e,t){e.error=!1,e.loading=!1},setTimeserie(e,t){e.timeserie=t.payload},setOpacity(e,t){e.opacity=t.payload}}}),{actions:ne}=ae,ie=()=>((0,N.N)({key:ae.name,reducer:ae.reducer}),(0,N.f)({key:ae.name,saga:K}),{actions:ae.actions}),le=function(e,t,a){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];const i=Object.entries(a).filter((t=>{let[a,i]=t;return null!==i&&e!==a&&!n.includes(a)})),l=t.filter((e=>i.every((t=>{let[a,n]=t;return e[a]===n})))).map((t=>t[e]));return[...new Set(l)]},se=(e,t)=>{const a=Object.entries(t).filter((e=>{let[t,a]=e;return null!==a}));return e.filter((e=>a.every((t=>{let[a,n]=t;return e[a]===n}))))},re=e=>{const{selected_map:t,layers:a,forecast_parameters:n}=e,i=Object.fromEntries(Object.entries(t).filter((e=>{let[t]=e;return X.includes(t)})));let l=oe(a,i,n.variables,t.data_series);for(;Object.values(l).filter((e=>0===e.length)).length>1;){const e=Object.entries(i).filter((e=>{let[t,a]=e;return null!==a})).pop()[0];i[e]=null,t[e]=null,l=oe(a,i,n.variables,t.data_series)}return[l,t]},oe=(e,t,a,n)=>({variables:a.map((e=>e.id)),forecast_models:le("forecast_model",e,t),scenarios:le("scenario",e,t),data_series:le("data_series",e,t,["time_windows","value_type","year_period"]),year_periods:le("year_period",e,t),time_windows:"no"===n?le("time_window",e,t):[],value_types:le("value_type",e,t)}),ce=(e,t)=>e.toLocaleString(void 0,{minimumFractionDigits:null!==t&&void 0!==t?t:2,maximumFractionDigits:null!==t&&void 0!==t?t:4}),de=e=>({p:.5,backgroundColor:"background.paper",[e.breakpoints.down("def")]:{pl:0,pr:0}}),pe=e=>({width:"20em",[e.breakpoints.down("def")]:{width:"18em"}}),me=e=>({p:"2px 4px",display:"flex",alignItems:"center",gap:1.5,boxShadow:"none"}),ue=e=>({m:0,p:0,display:"flex",alignItems:"center",gap:2,boxShadow:"none",justifyContent:"space-around"}),xe=e=>({height:"max-content"});var he=a(51536);const ge=e=>he.c9.fromISO(e).year.toString();var fe=a(1006),ye=a(27287),ve=a(28413),be=a(38792),je=a(30778);const _e=()=>{const e=(0,F.U$)(),t=(0,I.wA)(),a=ie(),{opacity:i}=(0,I.d4)((e=>e.map));return(0,n.useEffect)((()=>{e.map.eachLayer((e=>{e._url&&e._url.includes("/thredds/wms/")&&e.setOpacity(i)}))}),[e.map,i]),(0,b.jsx)(s.A,{sx:{width:120},children:(0,b.jsxs)(ve.A,{spacing:2,direction:"row",alignItems:"center",children:[(0,b.jsx)(je.A,{color:"secondary"}),(0,b.jsx)(be.Ay,{size:"small",color:"secondary","aria-label":"Opacit\xe0",value:i,onChangeCommitted:(e,n)=>t(a.actions.setOpacity(parseFloat(n.toString()))),step:.05,min:0,max:1})]})})};var Ae=a(81741);const we=e=>{const{value:t,setPoint:a,openCharts:n,className:l,defaultCenter:r,defaultZoom:o}=e,{cities:c,selected_map:d,timeserie:p}=(0,I.d4)((e=>e.map)),m=(0,R.ko)(),u=(0,F.U$)(),{t:x}=(0,i.B)(),h=()=>u.map.flyTo(r,o);return(0,b.jsxs)(s.A,{className:l,sx:de,children:[(0,b.jsx)(s.A,{component:"form",sx:me,children:(0,b.jsx)(C.A,{onKeyPress:e=>{"Enter"===e.key&&e.preventDefault()},size:"small",options:c,sx:pe,renderInput:e=>(0,b.jsx)(k.A,{...e,label:"",placeholder:"Ricerca per comune"}),onChange:(e,t)=>{"function"===typeof a&&a(t),t||h();const n=Object.values(m._layers).find((e=>e._url&&e._url.includes("public.places_cities.geometry")));n&&null!==t&&void 0!==t&&t.latlng&&(u.map.flyTo([t.latlng.lat,t.latlng.lng],u.map.getZoom()-1),n.setFeatureStyle(t.name,{color:"yellow",weight:1,radius:1,fill:!0,fillOpacity:1,opacity:1}),n.fire("click",{latlng:L.latLng([t.latlng.lat,t.latlng.lng]),layer:{properties:t}}),setTimeout((()=>{u.map.flyTo([t.latlng.lat,t.latlng.lng],u.map.getZoom()+1)}),100))},value:t,isOptionEqualToValue:(e,t)=>e.label===t.label})}),(0,b.jsxs)(s.A,{sx:ue,children:[(0,b.jsxs)(s.A,{sx:xe,children:[(null===t||void 0===t?void 0:t.latlng)&&(0,b.jsxs)(D.A,{size:"small",color:"secondary",variant:"outlined",onClick:()=>u.map.flyTo([t.latlng.lat,t.latlng.lng],u.map.getZoom()),endIcon:(0,b.jsx)(Ae.A,{fontSize:"small",color:"secondary"}),"aria-label":"Centra la mappa",children:[ce(t.latlng.lat),", ",ce(t.latlng.lng)]}),!(null!==t&&void 0!==t&&t.latlng)&&(0,b.jsx)(D.A,{size:"small",color:"secondary",variant:"outlined",onClick:h,"aria-label":"Centra la mappa",children:(0,b.jsx)(Ae.A,{})})]}),(0,b.jsx)(_e,{})]})]})},Se=e=>{let{time:t,value:a,unit:n}=e;return(0,b.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,b.jsx)("span",{style:{flex:"1 1 1px"}}),(0,b.jsxs)("div",{style:{padding:"0",margin:0},children:[(0,b.jsx)(fe.A,{fontSize:"small"})," ",ge(t)]}),(0,b.jsxs)("div",{style:{padding:"0",margin:0},children:[(0,b.jsx)(ye.A,{fontSize:"small"})," ",null!==a?ce(a,1):"-",n]}),(0,b.jsx)("span",{style:{flex:"1 1 1px"}})]})},Ce=e=>{const{value:t,setPoint:a,openCharts:n,className:l}=e,{cities:s,selected_map:r,timeserie:o}=(0,I.d4)((e=>e.map)),{t:c}=((0,R.ko)(),(0,F.U$)(),(0,i.B)());return(0,b.jsxs)("div",{style:{display:"flex",flexDirection:"row"},children:[(0,b.jsx)(Se,{time:o[0].values[0].time,value:o[0].values[0].value,unit:r.unit}),(0,b.jsx)("span",{style:{flex:"1 1 1px"}}),(0,b.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,b.jsx)("span",{style:{flex:"1 1 1px"}}),(0,b.jsx)(M.A,{onClick:()=>n(t),"aria-label":"Mostra serie temporale",children:(0,b.jsx)(T.A,{})}),(0,b.jsx)("span",{style:{flex:"1 1 1px"}})]})]})},ke=e=>{const t=e.param1;return(0,b.jsx)(n.Fragment,{children:(0,b.jsxs)("small",{children:["Dummy control, params: ",t]})})},De=e=>(0,b.jsx)(e.control,{param1:"test1"});class Me extends y().Control{constructor(e){super(e),this._div=void 0,this.control=void 0,this.onAdd=e=>(this._div=y().DomUtil.create("div",""),v.render((0,b.jsx)(De,{map:e,control:this.control}),this._div),this._div),this.onRemove=()=>{},this._div=null,this.control=(null===e||void 0===e?void 0:e.customComponent)||ke}}L.MousePosition=Me;const Te=(0,w.T7)((function(e){return new Me(e)}));var Le=a(59781);a(62403);y().Control.TimeDimension=y().Control.TimeDimension.extend({_getDisplayDateFormat:function(e){return Object.keys(this._map._layers).forEach((e=>{let t=this._map._layers[e];t&&t._url&&t._url.includes("/thredds/wms/","")&&(t._url.includes(this._map.selected_path)?this._map.setupFrontLayer(t,this._map):this._map.removeLayer(t))})),e.getFullYear()}});a(55392),a(40046);const Ie=e=>{const{selected_map:t}=(0,I.d4)((e=>e.map)),a=(0,F.U$)(),i=(0,n.useRef)(null),l=e=>{i.current=e},s=function(e,t){e&&!(arguments.length>2&&void 0!==arguments[2]&&arguments[2])&&e.bringToFront();try{Object.keys(t._layers).map((e=>{(e=t._layers[e])&&e._url&&e._url.includes("public.places_cities.geometry")&&e.bringToFront(),e&&e._url&&e._url.includes("".concat(P,"/thredds/wms/"))&&!e._url.includes(t.selected_path)&&t.removeLayer(e),e&&e.currentLayer&&e.currentLayer._url&&e.currentLayer._url.includes("".concat(P,"/thredds/wms/"))&&!e.currentLayer._url.includes(t.selected_path)&&(e.currentLayer.hide(),t.removeLayer(e))}))}catch(a){console.log(a)}};return(0,R.gY)("baselayerchange",(()=>s(i.current,a.map))),(0,R.gY)("timeload",(()=>s(i.current,a.map))),(0,R.gY)("timeloading",(()=>s(i.current,a.map))),(0,R.gY)("layeradd",(()=>s(i.current,a.map,!0))),(0,R.gY)("layerremove",(()=>s(i.current,a.map,!0))),(0,n.useEffect)((()=>{const e=a.map;if(e.setupFrontLayer||(e.setupFrontLayer=s),e.selected_path=t.path,t.path){if(i.current&&i.current._currentLayer&&i.current._currentLayer._url&&i.current._currentLayer._url.includes("".concat(P,"/thredds/wms/"))&&i.current._currentLayer._url.includes(t.path))return void s(i.current,e);let r=null;const o={layers:t.layer_id,format:"image/gif",numcolorbands:"100",version:"1.1.1",colorscalerange:"".concat(t.color_scale_min,",").concat(t.color_scale_max),logscale:"false",styles:"default-scalar/".concat(t.palette),width:256,transparent:!0,crs:y().CRS.EPSG3857,bounds:t.bbox},c={opacity:.85,attribution:'&copy; <a target="_blank" rel="noopener" href="https://www.arpa.veneto.it/">ARPAV - Arpa FVG</a>'},d=new f.TileLayer.WMS("".concat(P,"/thredds/wms/").concat(t.path),{...o,...(0,Le.P)(c,{__version:1,map:e})});if(t.id&&"yes"===t.data_series){if(r=y().timeDimension.layer.wms(d,{requestTimeFromCapabilities:!0,cache:0,cacheBackward:0,cacheForward:0,zIndex:1e3}),r){e.addLayer(r),s(r,a.map),l(r);try{e._controlContainer.getElementsByClassName("leaflet-bar-timecontrol")[0].style.display="flex"}catch(n){}}}else{e.addLayer(d),s(d,a.map),l(d);try{e._controlContainer.getElementsByClassName("leaflet-bar-timecontrol")[0].style.display="none"}catch(n){}}}}),[t.path]),null},Re={bottomleft:"leaflet-bottom leaflet-left",bottomright:"leaflet-bottom leaflet-right",topleft:"leaflet-top leaflet-left",topright:"leaflet-top leaflet-right"},Fe=e=>{var t,a;const[i,l]=n.useState(document.createElement("div")),s=e.position&&Re[e.position]||Re.topright,r=document.createElement("div");n.useEffect((()=>{const e=document.getElementsByClassName(s);l(e[0])}),[s]),void 0!==e.prepend&&!0===e.prepend?i.prepend(r):i.append(r);const o=((null===(t=e.container)||void 0===t||null===(a=t.className)||void 0===a?void 0:a.concat(" "))||"")+"leaflet-control",c={...e.container,className:o},d=(0,b.jsx)("div",{...c,children:e.children});return y().DomEvent.disableClickPropagation(i),v.createPortal(d,r)};var Oe=a(82151);const Ne={height:"100%",width:"100%"},ze=e=>({display:"flex",justifyContent:"center",backgroundColor:"white",width:"16.5em",marginRight:"0","&>p":{marginTop:"0.7em",marginBottom:"0.7em"}}),Be={width:"1em",height:"1em",marginRight:"0",backgroundColor:"white",display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"center",visibility:"hidden"},Ee=e=>({"& img":{width:"90px",[e.breakpoints.down("def")]:{width:"65px"},"@media screen and (max-height: 770px)":{width:"65px"}}}),Pe=e=>({width:"108px",height:"42px"}),We=e=>{const{className:t,isMobile:a}=e,{selected_map:n}=(0,I.d4)((e=>e.map));return(0,b.jsx)(s.A,{className:t,sx:Ee,children:n.id&&(0,b.jsxs)("div",{style:{backgroundColor:"white"},children:[(0,b.jsx)("img",{src:"".concat(P).concat(n.legend),alt:"Legenda"}),(0,b.jsx)(Oe.A,{id:"modal-modal-title",variant:"body1",component:"p",align:"center",children:n.unit})]})})};var Ve=a(55536),Ze=a(48513);a(13342);const He=e=>{const{selected_map:t}=(0,I.d4)((e=>e.map)),{selectCallback:a,selectedPoint:i,openCharts:l}=e,r=(0,R.ko)(),o=(0,F.U$)();return(0,n.useEffect)((()=>{let e=!1;const t=o.layerContainer||o.map,n="".concat("https://clima.arpa.veneto.it/vectortiles/","/public.places_cities.geometry/{z}/{x}/{y}.pbf");let l=y().vectorGrid.protobuf(n,{interactive:!0,vectorTileLayerStyles:{"public.places_cities.geometry":(e,t,a)=>{let n=.5,i="#808080";return t<=9?(n=.1,i="#b6b6b6"):t>=10&&t<11?n=.2:t>=11&&t<=12&&(n=.3),{color:i,weight:1,radius:1,fill:!0,fillOpacity:0,opacity:n}}},getFeatureId:function(t){return i&&t.properties.name===i.name&&(e=t.properties.name,l.setFeatureStyle(t.properties.name,{color:"#164d36",weight:2,radius:1,fill:!0,fillOpacity:0,opacity:1}),l.bringToFront()),t.properties.name}}).on("click",(function(t){if(l.resetFeatureStyle(e),e=t.layer.properties.name,e&&t.layer){const e={...t.layer.properties,latlng:t.latlng,label:t.layer.properties.name};a(e)}})).on("mouseover",(function(e){}));return o.map.addLayer(l),l.bringToFront(),()=>{try{l&&t.removeLayer(l)}catch(e){console.log("error REMOVING",e)}}}),[t,r,i]),i&&(0,b.jsx)(Ve.Z,{name:"custom",style:{zIndex:1e3},children:(0,b.jsx)(h.p,{center:[i.latlng.lat,i.latlng.lng],radius:2,pathOptions:{color:"#164d36"},children:(0,b.jsx)(Ze.z,{children:(0,b.jsx)(s.A,{sx:Pe,children:(0,b.jsx)(Ce,{openCharts:l,value:i})})})})})},qe=()=>(0,b.jsx)("div",{className:"custom-panel leaflet-bar leaflet-control",style:Be}),Ge=e=>(0,b.jsx)(s.A,{className:"custom-panel leaflet-bar leaflet-control leaflet-control-coordinates",sx:ze,children:(0,b.jsxs)("div",{children:["Lat \n      ".concat(ce(e.latlng.lat)),(0,b.jsx)("span",{style:{visibility:"hidden"},children:"__"}),"Long \n      ".concat(ce(e.latlng.lng))]})}),Je=e=>(0,b.jsx)(b.Fragment,{}),Ue=e=>{const{setPoint:t=(()=>{}),openCharts:a=(()=>{}),onReady:n=(()=>{}),selectedPoint:i=null,defaultCenter:s=[45.9,12.45],defaultZoom:r=8}=e,o=(0,c.A)(),d=(0,l.A)(o.breakpoints.down("def"));return(0,b.jsxs)(m.W,{style:Ne,className:"main-map",center:s,zoom:r,maxZoom:12,zoomControl:!1,timeDimensionControl:!0,timeDimensionextendedControl:!0,timeDimension:!0,timeDimensionOptions:{},timeDimensionControlOptions:{speedSlider:!1,backwardButton:!0,forwardButton:!0,playButton:!1},whenReady:e=>n(e.target),children:[(0,b.jsx)(u.p,{position:"topright"}),d&&(0,b.jsx)(Te,{position:"topright",customComponent:qe}),(0,b.jsx)(Fe,{position:"topright",children:(0,b.jsx)(We,{className:"leaflet-control-legend",isMobile:d})}),(0,b.jsx)(S,{position:"bottomright",customComponent:d?Je:Ge}),(0,b.jsx)(Fe,{position:"topleft",children:(0,b.jsx)(we,{className:"leaflet-control-search",value:i,setPoint:t,openCharts:a,defaultCenter:s,defaultZoom:r})}),(0,b.jsxs)(x.In,{position:"topright",children:[(0,b.jsx)(x.In.Overlay,{name:"Sensori",checked:!0,children:(0,b.jsx)(h.p,{center:[0,0],radius:2})}),(0,b.jsx)(x.In.BaseLayer,{checked:!0,name:"OpenStreetMap",children:(0,b.jsx)(g.e,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'\xa9 <a target="_blank" rel="noopener" href="http://osm.org/copyright">OpenStreetMap</a> contributors'})}),(0,b.jsx)(x.In.BaseLayer,{name:"Sentinel 2",children:(0,b.jsx)(g.e,{url:"https://s2maps-tiles.eu/wmts?layer=s2cloudless-2021_3857&style=default&tilematrixset=GoogleMapsCompatible&Service=WMTS&Request=GetTile&Version=1.0.0&Format=image%2Fjpeg&TileMatrix={z}&TileCol={x}&TileRow={y}",attribution:'\xa9 <a target="_blank" rel="noopener" href="https://s2maps.eu/">Sentinel-2 cloudless</a> by EOX'})})]}),(0,b.jsx)(He,{selectCallback:e=>t(e),selectedPoint:i,openCharts:a}),(0,b.jsx)(Ie,{})]})};var Ye=a(74818),$e=a(83221),Ke=a(5441),Qe=a(18450),Xe=a(34544),et=a(13302),tt=a(99624),at=a(13004),nt=a(80685),it=a(67991),lt=a(76746),st=a(71974),rt=a(38533),ot=a(35419),ct=a(26420),dt=a(67048),pt=a(45142),mt=a(91060);const ut=e=>({display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"space-between",[e.breakpoints.down("def")]:{flexDirection:"column"}}),xt={display:"flex",flexDirection:"column",justifyContent:"space-between",flexWrap:"wrap"},ht={display:"flex",flexDirection:"column",flexWrap:"wrap","& .MuiMenuItem-root":{whiteSpace:"initial"},"& .MuiFormControlLabel-root":{pt:2,pb:0,pl:0,pr:2,marginLeft:0,marginRight:0,width:"100%",alignItems:"flex-start"},"& .MuiButtonBase-root":{pt:0}},gt=e=>({display:"flex",flexDirection:"row",justifyContent:"space-between",gap:1,[e.breakpoints.down("def")]:{flexDirection:"column"}}),ft={height:"100%","& .MuiOutlinedInput-notchedOutline":{borderStyle:"none"}},yt={paddingLeft:1,paddingRight:1},vt={marginLeft:1,marginRight:1},bt={display:"flex",justifyContent:"center"},jt={display:"flex",justifyContent:"flex-end"},_t={pt:1,pb:2,pr:0,pl:1};function At(e){var t;const a=e.onChange?e.onChange:()=>{},i=e.valueSet,r=e.sx,o=e.menuSx,d=e.label,p=null!==(t=e.className)&&void 0!==t?t:"",m=()=>{var t;return null!==(t=e.mobileIcon)&&void 0!==t?t:(0,b.jsx)(b.Fragment,{})},u=(0,c.A)(),x=(0,l.A)(u.breakpoints.down("def")),[h,g]=n.useState(!1),f=i.map((e=>{let{rows:t}=e;return t.map((e=>{var t;let{items:a}=e;return null===(t=a.find((e=>e.selected)))||void 0===t?void 0:t.id}))})).flat().filter((e=>e));return(0,b.jsx)(Ye.A,{sx:r,className:p,hiddenLabel:!1,children:(0,b.jsxs)(st.A,{"aria-label":d,"aria-hidden":!1,multiple:!0,value:f,renderValue:()=>x?(0,b.jsx)(s.A,{sx:bt,"aria-label":d,children:(0,b.jsx)(m,{})}):i.map((e=>{let{rows:t}=e;return t.map((e=>{var t;let{items:a}=e;return null===(t=a.find((e=>e.selected)))||void 0===t?void 0:t.name}))})).flat().filter((e=>e)).join(" - "),open:h,onOpen:()=>g(!0),onClose:()=>g(!1),sx:ft,className:"MultiRadioSelect ".concat(h?"MultiRadioSelect-open":""),MenuProps:{sx:o},children:[(0,b.jsx)(s.A,{sx:jt,children:(0,b.jsx)(M.A,{sx:_t,color:"default",component:"label",onClick:()=>g(!1),"aria-label":"chiudi ".concat(d),children:(0,b.jsx)(lt.A,{fontSize:"medium"})})}),(0,b.jsx)(s.A,{className:"MultiRadioSelectMenu",sx:ut,children:i.map(((e,t)=>{let{rows:n}=e;return(0,b.jsx)(s.A,{className:"MultiRadioSelectMenuColumn",sx:xt,children:n.map((e=>(0,b.jsxs)("div",{className:"".concat(e.needsSelection?"NeedsSelection":""),children:[e.groupName&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Oe.A,{className:"MultiRadioSelectMenuGroupLabel",sx:yt,children:e.groupName}),(0,b.jsx)(rt.A,{sx:vt})]}),(0,b.jsx)(ot.A,{sx:ht,"aria-labelledby":"".concat(e.key,"-radio-group-label"),onChange:t=>((e,t)=>{a(t,e.target.value)})(t,e.key),children:e.items.map((e=>(0,b.jsx)(ct.A,{disableGutters:!0,disabled:e.disabled,children:(0,b.jsx)(dt.A,{className:"MultiRadioSelectMenuItem ".concat(e.selected?"MultiRadioSelectMenuItem-selected":""),value:e.id,control:(0,b.jsx)(pt.A,{}),checked:e.selected,label:(0,b.jsxs)(s.A,{sx:gt,children:[(0,b.jsx)("span",{"aria-label":e.name,children:e.name}),x?(0,b.jsx)(Oe.A,{variant:"caption",children:e.description}):(0,b.jsx)(mt.A,{title:e.description,children:(0,b.jsx)(it.A,{fontSize:"small"})})]})})},e.id)))})]},e.key)))},t)}))})]})})}var wt,St,Ct=a(57528),kt=a(88283);const Dt=(0,kt.i7)(wt||(wt=(0,Ct.A)(["\n    from {\n      border: 1px solid yellow;\n      background-color: #164d36;\n    }\n    to {\n      border: none;\n      background-color: #387e5d;\n    }\n"]))),Mt=(0,kt.i7)(St||(St=(0,Ct.A)(["\n    from {\n      border: none;\n      // background-color: #d18a5c;\n    }\n    to {\n      border: 1px solid yellow;\n      // background-color: #D5956F;\n    }\n"]))),Tt={fontFamily:"Titillium Web, Helvetica, sans-serif",alignItems:"flex-end","& .MuiSelect-select":{color:"primary.contrastText",paddingTop:"8px"},"& button":{color:"primary.contrastText"},"& .MuiTypography-root":{paddingTop:"4px"}},Lt=e=>({fontFamily:"Titillium Web, Helvetica, sans-serif",position:"static"}),It={flexBasis:"100%",fontFamily:"Titillium Web, Helvetica, sans-serif","--Grid-borderWidth":"1px",borderTop:"none",borderLeft:"var(--Grid-borderWidth) solid",borderColor:"divider","& > div":{borderRight:"var(--Grid-borderWidth) solid",borderBottom:"none",borderColor:"divider"}},Rt=e=>({border:"1px solid",borderColor:"divider",color:"success.contrastText",fontFamily:"Titillium Web, Helvetica, sans-serif",backgroundColor:"success.dark",pt:1.5,pb:.5,pl:1.5,pr:1.5}),Ft=e=>({color:"success.dark",backgroundColor:"secondary.light",fontFamily:"Titillium Web, Helvetica, sans-serif",paddingLeft:2}),Ot=e=>({fontFamily:"Titillium Web, Helvetica, sans-serif",backgroundColor:"success.dark","& .NeedsSelection":{animation:"".concat(Dt," 2s infinite ease")}}),Nt={fontFamily:"Titillium Web, Helvetica, sans-serif",paddingTop:1,paddingBottom:.5},zt=e=>({fontFamily:"Titillium Web, Helvetica, sans-serif",width:"100%",height:"100%","& .MuiSelect-select":{paddingTop:2,paddingBottom:1,paddingLeft:0},"& .MultiRadioSelect":{paddingLeft:2,borderRadius:"0",[e.breakpoints.down("def")]:{paddingLeft:0}},"& .MultiRadioSelect-open":{backgroundColor:"primary.main"},"& svg":{color:"primary.contrastText"}}),Bt=e=>({...zt(e),"& .MultiRadioSelect":{fontFamily:"Titillium Web, Helvetica, sans-serif",paddingLeft:4,borderRadius:"0",[e.breakpoints.down("def")]:{paddingLeft:0}}}),Et=e=>({color:"success.dark",backgroundColor:"secondary.light",fontFamily:"Titillium Web, Helvetica, sans-serif",paddingLeft:2,width:"47px"}),Pt=e=>({...Ot(),width:"47px"}),Wt=e=>({"& .MuiMenu-paper":{fontFamily:"Titillium Web, Helvetica, sans-serif",color:"primary.contrastText",backgroundColor:"primary.main",pt:0,pb:2,pl:2,pr:2,borderRadius:"0","& .MultiRadioSelectMenu":{fontFamily:"Titillium Web, Helvetica, sans-serif",gap:4,pr:3},"& .MultiRadioSelectMenuColumn":{fontFamily:"Titillium Web, Helvetica, sans-serif",gap:2},"& .MultiRadioSelectMenuGroupLabel":{fontFamily:"Titillium Web, Helvetica, sans-serif",textTransform:"uppercase"},"& .NeedsSelection":{animation:"".concat(Mt," 2s infinite ease")},"& .MultiRadioSelectMenuItem":{opacity:e.palette.action.notSelectedOpacity,"& svg":{color:"primary.contrastText"}},"& .MultiRadioSelectMenuItem-selected":{opacity:"1"},"& hr":{borderColor:"primary.contrastText",opacity:e.palette.action.notSelectedOpacity}}}),Vt={fontFamily:"Titillium Web, Helvetica, sans-serif",paddingLeft:2},Zt={display:"flex",justifyContent:"center",fontFamily:"Titillium Web, Helvetica, sans-serif",alighItems:"center",height:"100%"};var Ht=a(23470);const qt=e=>({color:"success.dark",fontWeight:"bold",display:"flex",justifyContent:"center",mt:5,mb:3}),Gt=e=>({display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}),Jt=e=>({overflow:"auto",boxSizing:"border-box",width:"calc(100% - ".concat(e.spacing(4),")"),height:"calc(100% - ".concat(e.spacing(4),")"),p:0,m:0,bgcolor:"background.paper",borderRadius:e.shape.borderRadius,boxShadow:12}),Ut=e=>({p:0,pt:4,m:0}),Yt=e=>({display:"flex",flexDirection:"row",justifyContent:"flex-end",alignItems:"flex-start",padding:0}),$t=e=>({display:"flex",flexDirection:"row",justifyContent:"flex-end",alignItems:"flex-end",padding:4,[e.breakpoints.down("def")]:{justifyContent:"center",pt:1,pb:1}}),Kt=e=>({display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"flex-end",padding:4,[e.breakpoints.down("def")]:{justifyContent:"center",pt:2,pb:2}}),Qt=e=>({ml:0,mr:0,mt:4,mb:4}),Xt=e=>({display:"flex",flexDirection:"row",flexWrap:"wrap",justifyContent:"flex-start",gap:16,[e.breakpoints.down("xl")]:{justifyContent:"space-between",gap:0}}),ea=e=>({color:"success.dark",fontWeight:"bold"}),ta=e=>({color:"success.dark"}),aa=e=>({display:"flex",flexDirection:"row",flexWrap:"nowrap",alignItems:"center",marginTop:4}),na=e=>({ml:3,mr:3,maxWidth:"24em",[e.breakpoints.down("def")]:{ml:2,mr:2},"& .MuiSlider-valueLabel":{backgroundColor:"success.dark"}}),ia=e=>({display:"flex",flexDirection:"row",alignItems:"center",gap:3,m:3,[e.breakpoints.down("def")]:{flexDirection:"column"}}),la=e=>({display:"flex",flexDirection:"column",gap:3});var sa=a(82514);const ra=e=>{let{mapBounds:t,downLoadBounds:a}=e;return(0,b.jsxs)(m.W,{center:[45.9,12.45],zoom:6,maxZoom:14,style:{height:"320px",width:"100%",minWidth:"320px"},children:[(0,b.jsx)(g.e,{attribution:'\xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),(0,b.jsxs)(Ve.Z,{name:"yellow-rectangle",style:{zIndex:500},children:[(0,b.jsx)(sa.M,{bounds:t,pathOptions:{color:"grey"}}),(0,b.jsx)(sa.M,{bounds:a,pathOptions:{color:"yellow"}})]})]})},oa=e=>{var t;const a=null!==(t=e.onChange)&&void 0!==t?t:()=>{},{t:l}=(0,i.B)(),{selected_map:r,forecast_parameters:o,timeserie:c}=(0,I.d4)((e=>null===e||void 0===e?void 0:e.map)),d=[[r.bbox[1][1],r.bbox[0][1]],[r.bbox[1][0],r.bbox[0][0]]],[p,m]=n.useState(d),[u,x]=n.useState(!1),h=e=>{m(e),JSON.stringify(e)!==JSON.stringify(d)?x(!0):x(!1)},g=c?c[0].values.map((e=>e.time)):[],f=[...g.keys()],[y,v]=n.useState([0,f.length-1]),j=(e,t)=>{var a,n,i;const l=r[e];let s="";return l&&(s=null===(a=o[t])||void 0===a||null===(n=a.find((e=>e.id===l)))||void 0===n?void 0:n.name),null!==(i=s)&&void 0!==i?i:""},_=e=>e.filter((e=>e)).join(" - ");return n.useEffect((()=>{const e={};e.time_start=g[y[0]],e.time_end=g[y[1]],a(e)}),[y]),n.useEffect((()=>{const e={};e.north=parseFloat(p[1][0]),e.south=parseFloat(p[0][0]),e.east=parseFloat(p[1][1]),e.west=parseFloat(p[0][1]),a(e)}),[p]),(0,b.jsxs)(s.A,{sx:Xt,children:[(0,b.jsxs)(s.A,{children:[(0,b.jsxs)(s.A,{sx:Qt,children:[(0,b.jsx)(Oe.A,{variant:"h6",sx:ea,children:l("app.map.menuBar.indicator")}),(0,b.jsx)(Oe.A,{variant:"body1",sx:ta,children:j("variable","variables")})]}),(0,b.jsxs)(s.A,{sx:Qt,children:[(0,b.jsx)(Oe.A,{variant:"h6",sx:ea,children:l("app.map.menuBar.model")}),(0,b.jsx)(Oe.A,{variant:"body1",sx:ta,children:_([j("forecast_model","forecast_models"),j("scenario","scenarios")])})]}),(0,b.jsxs)(s.A,{sx:Qt,children:[(0,b.jsx)(Oe.A,{variant:"h6",sx:ea,children:l("app.map.menuBar.period")}),(0,b.jsx)(Oe.A,{variant:"body1",sx:ta,children:_([j("data_series","data_series"),j("value_type","value_types"),j("time_window","time_windows")])})]}),(0,b.jsxs)(s.A,{sx:Qt,children:[(0,b.jsx)(Oe.A,{variant:"h6",sx:ea,children:l("app.map.menuBar.season")}),(0,b.jsx)(Oe.A,{variant:"body1",sx:ta,children:j("year_period","year_periods")})]}),(0,b.jsxs)(s.A,{sx:Qt,children:[(0,b.jsx)(Oe.A,{variant:"h6",sx:ea,children:l("app.map.downloadDataDialog.map.unit")}),(0,b.jsx)(Oe.A,{variant:"body1",sx:ta,children:null===r||void 0===r?void 0:r.unit})]}),(0,b.jsxs)(s.A,{sx:Qt,children:[(0,b.jsx)(Oe.A,{variant:"h6",sx:ea,children:l("app.map.downloadDataDialog.map.timeRange")}),(0,b.jsxs)(s.A,{sx:aa,children:[(0,b.jsx)("span",{children:g[y[0]].substring(4,0)}),(0,b.jsx)(be.Ay,{sx:na,getAriaValueText:()=>l("app.map.downloadDataDialog.map.timeRangeLabel"),valueLabelDisplay:"auto",step:1,min:0,max:g.length-1,value:y,onChange:(e,t)=>{v(t)},valueLabelFormat:e=>g[e].substring(4,0),disableSwap:!0}),(0,b.jsx)("span",{children:g[y[1]].substring(4,0)})]})]})]}),(0,b.jsx)(s.A,{children:(0,b.jsxs)(s.A,{sx:Qt,children:[(0,b.jsx)(ra,{mapBounds:d,downLoadBounds:p}),(0,b.jsxs)(s.A,{sx:ia,children:[(0,b.jsx)(k.A,{id:"outlined-number",label:l("app.map.downloadDataDialog.map.west"),type:"number",value:p[0][1],onChange:e=>{h([[p[0][0],Number(e.target.value.replace(",","."))],[p[1][0],p[1][1]]])},InputProps:{inputProps:{max:d[1][1],min:d[0][1],step:.001}}}),(0,b.jsxs)(s.A,{sx:la,children:[(0,b.jsx)(k.A,{id:"outlined-number",label:l("app.map.downloadDataDialog.map.north"),type:"number",value:p[1][0],onChange:e=>{h([[p[0][0],p[0][1]],[Number(e.target.value.replace(",",".")),p[1][1]]])},InputProps:{inputProps:{max:d[1][0],min:d[0][0],step:.001}}}),(0,b.jsx)(k.A,{id:"outlined-number",label:l("app.map.downloadDataDialog.map.south"),type:"number",value:p[0][0],onChange:e=>{h([[Number(e.target.value.replace(",",".")),p[0][1]],[p[1][0],p[1][1]]])},InputProps:{inputProps:{max:d[1][0],min:d[0][0],step:.001}}})]}),(0,b.jsx)(k.A,{id:"outlined-number",label:l("app.map.downloadDataDialog.map.east"),type:"number",value:p[1][1],onChange:e=>{h([[p[0][0],p[0][1]],[p[1][0],Number(e.target.value.replace(",","."))]])},InputProps:{inputProps:{max:d[1][1],min:d[0][1],step:.001}}})]}),u&&(0,b.jsx)(D.A,{size:"small",onClick:()=>{m(d)},children:"Ripristina coordinate originali"})]})})]})};var ca=a(44361),da=a(20692),pa=a(99940),ma=a(81271),ua=a(88650),xa=a(98561),ha=a(43939),ga=a(60666);const fa=e=>({display:"flex",flexWrap:"wrap"}),ya=e=>({m:6,[e.breakpoints.down("def")]:{m:3}}),va=e=>({width:"20em",[e.breakpoints.down("def")]:{width:"18em"}}),ba=e=>{var t,a;const r=null!==(t=e.onValidityChange)&&void 0!==t?t:()=>{},o=null!==(a=e.onChange)&&void 0!==a?a:()=>{};let d=function(e){return e.Study="study",e.Inst="institutional",e.Comm="commercial",e.Other="other",e}({});const p=localStorage&&"string"===typeof localStorage.getItem("user_form")?JSON.parse(localStorage.getItem("user_form")):{membership:"",place:"",other_reason:"",accept_disclaimer:!1},{t:m}=(0,i.B)(),u=(0,c.A)(),x=(0,l.A)(u.breakpoints.down("def")),[h,g]=n.useState(!0),{cities:f}=(0,I.d4)((e=>e.map)),y=()=>{const{isValid:e}=(0,ha.j7)();return n.useEffect((()=>{r(e)}),[e]),null};(0,n.useEffect)((()=>{o(p)}),[]);const v=e=>{var t;console.debug("Form change",e);const a=e;let n={};var i,l,s,r;null!==a&&void 0!==a&&null!==(t=a.target)&&void 0!==t&&t.name&&("checkbox"===(null===a||void 0===a||null===(i=a.target)||void 0===i?void 0:i.type)?n["".concat(a.target.name)]=null===a||void 0===a||null===(l=a.target)||void 0===l?void 0:l.checked:n["".concat(a.target.name)]=null===a||void 0===a||null===(s=a.target)||void 0===s?void 0:s.value,"reason"===a.target.name&&g((null===a||void 0===a||null===(r=a.target)||void 0===r?void 0:r.value)!==d.Other));if("string"===typeof localStorage.getItem("user_form")){const e=JSON.parse(localStorage.getItem("user_form")),t="boolean"===typeof n.accept_disclaimer?n.accept_disclaimer:!0===e.accept_disclaimer;n={...e,...n,accept_disclaimer:t}}localStorage.setItem("user_form",JSON.stringify(n)),o(n)};return(0,b.jsx)(s.A,{children:(0,b.jsx)(ha.l1,{enableReinitialize:!0,initialValues:p,validateOnMount:!0,validationSchema:ga.Ik({reason:ga.Yj().required(),public:ga.zM().required(),accept_disclaimer:ga.zM().oneOf([!0],m("app.map.downloadDataDialog.user.disclaimerReadError"))}),onSubmit:async e=>{},children:e=>(0,b.jsxs)(ha.lV,{onChange:v,children:[(0,b.jsxs)(s.A,{sx:fa,children:[(0,b.jsx)(s.A,{sx:ya,children:(0,b.jsx)(ha.D0,{id:"place",name:"place",component:pa.j,options:f,isOptionEqualToValue:(e,t)=>e.label===t,onInputChange:(e,t,a)=>{v({target:{name:"place",value:t}})},onChange:(t,a)=>{e.setFieldValue("place",a)},renderInput:e=>(0,b.jsx)(k.A,{...e,name:"place",label:m("app.map.downloadDataDialog.user.aoi"),variant:"outlined",sx:va}),size:x?"small":"medium"})}),(0,b.jsx)(s.A,{sx:ya,children:(0,b.jsx)(ha.D0,{id:"membership",name:"membership",type:"text",label:m("app.map.downloadDataDialog.user.membership"),component:ma.A,sx:va,size:x?"small":"medium"})}),(0,b.jsxs)(s.A,{sx:ya,children:[(0,b.jsx)(ca.A,{children:m("app.map.downloadDataDialog.user.subject")}),(0,b.jsxs)(ha.D0,{component:ua.z,id:"public",name:"public",size:x?"small":"medium",children:[(0,b.jsx)(dt.A,{value:!1,control:(0,b.jsx)(pt.A,{}),label:m("app.map.downloadDataDialog.user.private")}),(0,b.jsx)(dt.A,{value:!0,control:(0,b.jsx)(pt.A,{}),label:m("app.map.downloadDataDialog.user.public")})]})]}),(0,b.jsxs)(s.A,{sx:ya,children:[(0,b.jsx)(ca.A,{children:m("app.map.downloadDataDialog.user.goal")}),(0,b.jsxs)(ha.D0,{component:ua.z,id:"reason",name:"reason",size:x?"small":"medium",children:[(0,b.jsx)(dt.A,{value:d.Study,control:(0,b.jsx)(pt.A,{}),label:m("app.map.downloadDataDialog.user.study")}),(0,b.jsx)(dt.A,{value:d.Inst,control:(0,b.jsx)(pt.A,{}),label:m("app.map.downloadDataDialog.user.institutional")}),(0,b.jsx)(dt.A,{value:d.Comm,control:(0,b.jsx)(pt.A,{}),label:m("app.map.downloadDataDialog.user.commercial")}),(0,b.jsx)(dt.A,{value:d.Other,control:(0,b.jsx)(pt.A,{}),label:(0,b.jsx)(ha.D0,{id:"other_reason",name:"other_reason",type:"text",component:ma.A,disabled:h,variant:"standard",placeholder:m("app.map.downloadDataDialog.user.other"),size:x?"small":"medium"})})]})]})]}),(0,b.jsx)(s.A,{sx:ya,children:(0,b.jsxs)(Oe.A,{variant:"body1",children:[m("app.map.downloadDataDialog.required"),(0,b.jsx)("br",{})]})}),(0,b.jsx)(s.A,{sx:ya,children:(0,b.jsx)(k.A,{InputProps:{readOnly:!0},multiline:!0,label:m("app.map.downloadDataDialog.user.disclaimer"),defaultValue:m("app.map.downloadDataDialog.user.disclaimerText"),fullWidth:!0,size:x?"small":"medium"})}),(0,b.jsxs)(s.A,{sx:ya,children:[(0,b.jsx)(ha.D0,{required:!0,id:"accept_disclaimer",name:"accept_disclaimer",type:"checkbox",Label:{label:m("app.map.downloadDataDialog.user.disclaimerRead")},component:xa._,size:x?"small":"medium"})," ",(0,b.jsx)(da.A,{href:"/data",target:"_blank",children:"Data policy"})," ","-"," ",(0,b.jsx)(da.A,{href:"/info",target:"_blank",children:m("app.header.menu.info")})]}),(0,b.jsx)(y,{})]})})})},ja=e=>{const t=e.open,a=e.setOpen,{t:l}=(0,i.B)(),s=((0,I.wA)(),ie(),G.getInstance(),n.useRef({})),[r,o]=n.useState(!0),[c,d]=n.useState(!1),[p,m]=n.useState(""),{selected_map:u}=(0,I.d4)((e=>null===e||void 0===e?void 0:e.map)),x=e=>{s.current={...s.current,...e};const t={id:parseInt(u.id),...s.current,...e},a="".concat(E,"/maps/ncss/netcdf/?").concat(new URLSearchParams(t).toString());m(a)};return(0,b.jsx)(Ht.A,{open:t,sx:Gt,children:(0,b.jsxs)(Ke.A,{container:!0,rowSpacing:0,columnSpacing:{xs:0},columns:{xs:28,def:28},sx:Jt,children:[(0,b.jsx)(Ke.A,{xs:1}),(0,b.jsx)(Ke.A,{xs:26,children:(0,b.jsx)(Oe.A,{variant:"h6",sx:qt,children:l("app.header.acronymMeaning")})}),(0,b.jsx)(Ke.A,{xs:1,sx:Yt,children:(0,b.jsx)(M.A,{color:"secondary","aria-label":l("app.common.close"),component:"label",onClick:()=>a(!1),children:(0,b.jsx)(lt.A,{fontSize:"large"})})}),(0,b.jsx)(Ke.A,{xs:1}),(0,b.jsx)(Ke.A,{xs:26,children:(0,b.jsxs)(Ke.A,{container:!0,rowSpacing:0,columnSpacing:{xs:0},columns:{xs:26,def:26},sx:Ut,children:[(0,b.jsx)(Ke.A,{xs:26,children:(0,b.jsx)(oa,{onChange:x})}),(0,b.jsx)(Ke.A,{xs:26,children:(0,b.jsx)(ba,{onChange:x,onValidityChange:e=>{o(!e)}})})]})}),(0,b.jsx)(Ke.A,{xs:1}),(0,b.jsx)(Ke.A,{xs:0,def:1}),(0,b.jsx)(Ke.A,{xs:28,def:11,sx:$t,children:(0,b.jsx)(D.A,{color:"primary",variant:"contained",disabled:r||c,href:p,target:"_blank",children:l("app.map.downloadDataDialog.DLNetCDF")})}),(0,b.jsx)(Ke.A,{xs:28,def:11,sx:Kt,children:(0,b.jsx)(D.A,{variant:"contained",color:"secondary",onClick:()=>a(!1),children:l("app.common.close")})}),(0,b.jsx)(Ke.A,{xs:0,def:1})]})})};const _a=function(){return(0,b.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",version:"1.1",viewBox:"0 0 50 50",children:(0,b.jsx)("path",{d:"M39.76 25.19c0 .68-.04 1.37-.17 2.03-.31 2.18-1.14 4.21-2.36 5.93-.85 1.24-1.93 2.34-3.15 3.21-1.7 1.29-3.69 2.16-5.85 2.51-.77.17-1.58.23-2.38.23V11.28c.68 0 1.35.04 2.01.17 2.24.31 4.29 1.16 6.04 2.41 1.18.83 2.24 1.85 3.07 3.01 1.31 1.72 2.22 3.73 2.57 5.93.17.79.23 1.58.23 2.41ZM34.54.79l-.48 11.23a15.689 15.689 0 0 0-7.01-2.79L34.54.79ZM34.93 49.21l-7.44-8.12c2.51-.41 4.82-1.42 6.79-2.92l.65 11.03ZM48.83 14.86l-8.22 7.54c-.41-2.55-1.47-4.89-2.99-6.89l11.2-.65ZM49 34.9l-11.06-.46c1.42-2 2.39-4.36 2.75-6.89L49 34.9ZM22.9 8.82l-2.63 6.85-2.98-6.28 2.47-7.75-1.4-.44-1.99 6.25-2.03-4.29-1.32.63 2.08 4.37-5.9-1.87-.44 1.39 7.18 2.28 2.85 6.03-6.17-2.96-.99.95 2.93 6.73-5.69-1.96-3.82-7.18-1.29.69 3.07 5.79-4.48-1.54-.47 1.39 4.56 1.57L1 22.37l.69 1.29 6.64-3.54h.01l5.31 1.83-6.26 2.21-.03 1.38 6.66 2.71-5.34 2.14-6.82-3.2-.63 1.33 5.6 2.62-4.51 1.8.54 1.36 4.42-1.77-2.79 5.94 1.33.61 3.44-7.34 5.22-2.09-2.91 6.09.92.99 6.79-2.62-2.5 6.04-7.05 2.65.51 1.38L16.02 42l-1.86 4.48 1.35.56 1.81-4.39 2.31 6.14 1.38-.51-2.85-7.62 2.44-5.91 2.3 5.72 1.4-.26V9.09l-1.4-.26Zm-9.16 6.38 6.04 2.88 2.18 4.61s-.18.19-.37.44l-5.16-1.77-2.69-6.16Zm-4.05 9.7 6.2-2.19 5.12 1.77c-.03.1-.03.2-.03.32 0 .22.03.42.07.61l-5.08 2.05-6.29-2.56Zm10.37 7.33-6.36 2.44 2.79-5.85 5.34-2.14c.15.13.29.25.47.34l-.07-.03-2.17 5.24Zm2.78 4.16-1.45-3.58 1.45-3.48v7.07Zm0-15.26-1.71-3.61 1.71-4.48v8.09Z"})})};const Aa=function(e){var t;const a=null!==(t=e.onDownloadMapImg)&&void 0!==t?t:()=>{},{selected_map:r,forecast_parameters:o,selectactable_parameters:d,timeserie:p}=(0,I.d4)((e=>null===e||void 0===e?void 0:e.map)),{t:m}=(0,i.B)(),u=(0,I.wA)(),x=ie(),h=(e,t)=>{const a=o[t].map((a=>({...a,disabled:!(Array.isArray(d[t])&&d[t].includes(null===a||void 0===a?void 0:a.id)),selected:r[e]===a.id}))),n=null==r[e]&&a.filter((e=>!1===e.disabled)).length>0;return{items:a,needsSelection:n}},g=()=>({variableMenuSet:[{rows:[{key:"variable",groupName:"",...h("variable","variables")}]}],modelAndScenarioMenuSet:[{rows:[{key:"forecast_model",groupName:m("app.map.menu.models"),...h("forecast_model","forecast_models")}]},{rows:[{key:"scenario",groupName:m("app.map.menu.scenarios"),...h("scenario","scenarios")}]}],periodMenuSet:[{rows:[{key:"data_series",groupName:m("app.map.menu.dataSeries"),...h("data_series","data_series")},{key:"value_type",groupName:m("app.map.menu.valueTypes"),...h("value_type","value_types")},{key:"time_window",groupName:m("app.map.menu.timeWindows"),...h("time_window","time_windows")}]}],seasonMenuSet:[{rows:[{key:"year_period",groupName:"",...h("year_period","year_periods")}]}]}),[f,y]=(0,n.useState)(g());(0,n.useEffect)((()=>{y(g())}),[o,d,r]);const v=(0,c.A)(),j=(0,l.A)(v.breakpoints.down("def")),[_,A]=n.useState(!1),w=(e,t)=>{u(x.actions.changeSelection({key:e,value:t}))},S=e=>e.filter((e=>e.rows.filter((e=>e.needsSelection)).length>0)).length>0;return(0,b.jsxs)(Ye.A,{sx:Lt,children:[(0,b.jsx)($e.A,{disableGutters:!0,sx:Tt,children:(0,b.jsxs)(Ke.A,{container:!0,rowSpacing:0,columnSpacing:{xs:0},columns:{xs:7,def:11},sx:It,children:[j?(0,b.jsx)(b.Fragment,{}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Ke.A,{xs:2,sx:Ft,children:(0,b.jsx)(s.A,{sx:Vt,children:(0,b.jsx)(Oe.A,{sx:Nt,children:m("app.map.menuBar.indicator")})})}),(0,b.jsx)(Ke.A,{xs:2,sx:Ft,children:(0,b.jsx)(s.A,{children:(0,b.jsx)(Oe.A,{sx:Nt,children:m("app.map.menuBar.model")})})}),(0,b.jsx)(Ke.A,{xs:2,sx:Ft,children:(0,b.jsx)(s.A,{children:(0,b.jsx)(Oe.A,{sx:Nt,children:m("app.map.menuBar.period")})})}),(0,b.jsx)(Ke.A,{xs:2,sx:Ft,children:(0,b.jsx)(s.A,{children:(0,b.jsx)(Oe.A,{sx:Nt,children:m("app.map.menuBar.season")})})}),(0,b.jsx)(Ke.A,{xs:1,sx:Ft,children:(0,b.jsx)(s.A,{})}),(0,b.jsx)(Ke.A,{xs:1,sx:Ft,children:(0,b.jsx)(s.A,{})}),(0,b.jsx)(Ke.A,{xs:1,sx:Et,children:(0,b.jsx)(s.A,{})})]}),(0,b.jsx)(Ke.A,{xs:1,def:2,sx:Ot,children:(0,b.jsx)(At,{valueSet:f.variableMenuSet,onChange:w,sx:Bt,menuSx:Wt,mobileIcon:(0,b.jsx)(Qe.A,{}),className:S(f.variableMenuSet)?"NeedsSelection":"",label:m("app.map.menuBar.indicator")})}),(0,b.jsx)(Ke.A,{xs:1,def:2,sx:Ot,children:(0,b.jsx)(At,{valueSet:f.modelAndScenarioMenuSet,onChange:w,sx:zt,menuSx:Wt,mobileIcon:(0,b.jsx)(Xe.A,{}),className:S(f.modelAndScenarioMenuSet)?"NeedsSelection":"",label:m("app.map.menuBar.model")})}),(0,b.jsx)(Ke.A,{xs:1,def:2,sx:Ot,children:(0,b.jsx)(At,{valueSet:f.periodMenuSet,onChange:w,sx:zt,menuSx:Wt,mobileIcon:(0,b.jsx)(et.A,{}),className:S(f.periodMenuSet)?"NeedsSelection":"",label:m("app.map.menuBar.period")})}),(0,b.jsx)(Ke.A,{xs:1,def:2,sx:Ot,children:(0,b.jsx)(At,{valueSet:f.seasonMenuSet,onChange:w,sx:zt,menuSx:Wt,mobileIcon:(0,b.jsx)(_a,{}),className:S(f.seasonMenuSet)?"NeedsSelection":"",label:m("app.map.menuBar.season")})}),(0,b.jsx)(Ke.A,{xs:1,sx:Ot,children:(0,b.jsxs)(s.A,{sx:Zt,children:[j?(0,b.jsx)(M.A,{onClick:()=>A(!0),disabled:0===p.length,"aria-label":m("app.map.menuBar.downloadData"),children:(0,b.jsx)(nt.A,{})}):(0,b.jsx)(D.A,{startIcon:(0,b.jsx)(nt.A,{}),onClick:()=>A(!0),disabled:0===p.length,"aria-label":m("app.map.menuBar.downloadData"),children:m("app.map.menuBar.downloadData")}),(0,b.jsx)(ja,{open:_,setOpen:A})]})}),(0,b.jsx)(Ke.A,{xs:1,sx:Ot,children:(0,b.jsx)(s.A,{sx:Zt,children:j?(0,b.jsx)(M.A,{onClick:()=>a(),"aria-label":m("app.map.menuBar.downloadMap"),children:(0,b.jsx)(at.A,{})}):(0,b.jsx)(D.A,{startIcon:(0,b.jsx)(at.A,{}),onClick:()=>a(),"aria-label":m("app.map.menuBar.downloadMap"),children:m("app.map.menuBar.downloadMap")})})}),(0,b.jsx)(Ke.A,{xs:1,sx:Pt,children:(0,b.jsx)(s.A,{sx:Zt,children:(0,b.jsx)(M.A,{onClick:()=>a(),"aria-label":m("app.map.menuBar.downloadMap"),children:(0,b.jsx)(tt.A,{})})})})]})}),j&&(0,b.jsx)($e.A,{sx:Rt,children:(0,b.jsx)(Oe.A,{variant:"caption",children:[["variable","variables"],["forecast_model","forecast_models"],["scenario","scenarios"],["data_series","data_series"],["value_type","value_types"],["time_window","time_windows"],["year_period","year_periods"]].map((e=>((e,t)=>{var a,n,i;const l=r[e];let s="";return l&&(s=null===(a=o[t])||void 0===a||null===(n=a.find((e=>e.id===l)))||void 0===n?void 0:n.name),null!==(i=s)&&void 0!==i?i:""})(e[0],e[1]))).filter((e=>e)).join(", ")})})]})};var wa=a(76996);const Sa=e=>({color:"success.dark",fontWeight:"bold",display:"flex",justifyContent:"center",mt:5,mb:3}),Ca=e=>({display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}),ka=e=>({overflow:"auto",boxSizing:"border-box",width:"calc(100% - ".concat(e.spacing(4),")"),height:"calc(100% - ".concat(e.spacing(4),")"),p:0,m:0,bgcolor:"background.paper",borderRadius:e.shape.borderRadius,boxShadow:12}),Da=e=>({paddingTop:4}),Ma=e=>({display:"flex",flexDirection:"row",justifyContent:"flex-end",alignItems:"flex-start",padding:0}),Ta=e=>({display:"flex",flexDirection:"row",justifyContent:"flex-end",alignItems:"flex-end",padding:4,[e.breakpoints.down("def")]:{justifyContent:"center",pt:2,pb:2}}),La=e=>({display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"flex-end",padding:4,[e.breakpoints.down("def")]:{justifyContent:"center",pt:2,pb:2}}),Ia=e=>({display:"flex",flexDirection:"row",gap:"0.5em",ml:5,mr:5,mt:3,mb:3,[e.breakpoints.down("def")]:{mt:1,mb:1}}),Ra=e=>({display:"flex",flexDirection:"row",[e.breakpoints.down("def")]:{flexDirection:"column",mt:5,mb:5}}),Fa=e=>({color:"secondary.dark",fontWeight:"bold",pt:8}),Oa=e=>({"& .echarts-for-react":{minHeight:"600px"}}),Na=e=>({display:"flex",justifyContent:"center",paddingTop:18});var za=a(13822),Ba=a(23110),Ea=a(60752);const Pa=(0,a(85913).Mz)([e=>e.map||te],(e=>e)),Wa=e=>{var t,a,o;const{latLng:d,setIds:p,setTimeRange:m,place:u=""}=e,x=G.getInstance(),h=(0,c.A)(),g=(0,l.A)(h.breakpoints.down("def")),[f,y]=(0,n.useState)(!0),v=n.useRef(null),j=(0,I.wA)(),_=ie(),A=(e,t)=>{var a,n,i;const l=S[e];let s="";return l&&(s=null===(a=k[t])||void 0===a||null===(n=a.find((e=>e.id===l)))||void 0===n?void 0:n.name),null!==(i=s)&&void 0!==i?i:""},w=(e,t)=>{var a,n;return(null===(a=k[t])||void 0===a||null===(n=a.find((t=>t.id===e)))||void 0===n?void 0:n.name)||""},{selected_map:S,layers:C,forecast_parameters:k,selectactable_parameters:D,timeserie:M}=(0,I.d4)(Pa),{scenarios:T,forecast_models:L}=D,[R,F]=n.useState([S.forecast_model,S.forecast_model.includes("ens")?null:L.find((e=>e.includes("ens")))]),[O,N]=(0,n.useState)([]),z=e=>e.filter((e=>e)).join(" - "),B=[{Rcp26:"rgb(46,105,193)",Rcp45:"rgb(243, 156, 18)",Rcp85:"rgb(231,60,60)"},{Rcp26:"rgba(46,105,193, 0.4)",Rcp45:"rgba(243, 156, 18, 0.4)",Rcp85:"rgba(231,60,60, 0.4)"}];(0,n.useEffect)((()=>{N([]);const e=Object.fromEntries(Object.entries(S).filter((e=>{let[t]=e;return ee.includes(t)}))),t=R.filter((e=>e)).map((t=>T.map((a=>{const n={...e,forecast_model:t,scenario:a},i=((e,t)=>{const a=Object.entries(t).filter((e=>{let[t,a]=e;return null!==a}));return e.find((e=>a.every((t=>{let[a,n]=t;return e[a]===n}))))})(C,n);return i?null===i||void 0===i?void 0:i.id:null})))).flat();p(t),x.getTimeseries(t,d.lat,d.lng).then((e=>{N(e.results)})).catch((e=>{console.log(e),j(_.actions.genericError({error:"app.error.dlTimeSeries"}))}))}),[S,D,R]);const{t:E}=(0,i.B)(),P=e=>{if(f){const t=11,a=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:11,a=[];if(e.length<t)return a;let n=0;for(let l=0;l<t;++l)n+=e[l];a.push((n/t).toFixed(1));const i=e.length-t-1;for(let l=0;l<i;++l)n-=e[l],n+=e[l+t],a.push((n/t).toFixed(1));return a}(e.values.map((e=>e.value)),t);return e.values.map(((e,n)=>[e.time.substring(0,4),t>=n?a[0]:a[n-t]]))}return e.values.map((e=>[e.time.substring(0,4),e.value]))},W=null===O||void 0===O?void 0:O.map((e=>{return{name:"".concat(w(e.dataset.scenario_id,"scenarios")," - ").concat(w(e.dataset.forecast_model_id,"forecast_models")),type:"line",smooth:!0,symbol:"none",lineStyle:{color:(t=e.dataset,(t.forecast_model===R[0]?B[0]:B[1])[t.scenario]),type:(e.dataset,"solid"),opacity:(e.dataset,1)},data:P(e)};var t})),V={title:{text:"\n     ".concat(A("variable","variables"),"\n  "),subtext:"\n    ".concat(A("value_type","value_types"),"  -  ").concat(A("year_period","year_periods"),"  -  ").concat(E("app.map.timeSeriesDialog.from")," ").concat(ge(S.time_start)," ").concat(E("app.map.timeSeriesDialog.to")," ").concat(ge(S.time_end)," - ").concat(u?u+" - ":"").concat(E("app.map.timeSeriesDialog.lat")," ").concat(ce(d.lat)," ").concat(E("app.map.timeSeriesDialog.lng")," ").concat(ce(d.lng),"     \xa9 ARPAV - Arpa FVG\n  Si tratta di proiezioni climatiche e non di previsioni a lungo termine. Il valore annuale ha validit\xe0 in un contesto di trend trentennale."),textStyle:g?{width:300,overflow:"break"}:{},subtextStyle:g?{width:300,overflow:"break"}:{},itemGap:-22,top:"5%",left:"center"},color:W.map((e=>e.lineStyle.color)),tooltip:{trigger:"axis",axisPointer:{label:{show:!0,formatter:e=>"".concat(E("app.map.timeSeriesDialog.xUnit")," ").concat(null!==e.value?ce(e.value,1):"-")}},valueFormatter:e=>{var t,a;return"".concat(null!==e?ce(e,1):"-"," ").concat(null===(t=O[0])||void 0===t||null===(a=t.dataset)||void 0===a?void 0:a.unit)}},legend:{data:null===O||void 0===O?void 0:O.map((e=>"".concat(w(e.dataset.scenario_id,"scenarios")," - ").concat(w(e.dataset.forecast_model_id,"forecast_models")))),top:"30%",icon:"rect"},grid:{top:"48%",left:"3%",right:"4%",bottom:"3%",containLabel:!0},toolbox:{itemSize:30,left:g?"center":"right",feature:{saveAsImage:{name:"Serie temporale ".concat(A("variable","variables")," - ").concat(z([A("forecast_model","forecast_models")])," - ").concat(z([A("data_series","data_series"),A("value_type","value_types"),A("time_window","time_windows")])," - ").concat(A("year_period","year_periods")),title:E("app.map.timeSeriesDialog.saveAsImage"),icon:"path://M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z",iconStyle:{color:h.palette.primary.main}}}},xAxis:{type:"category",boundaryGap:!1,axisLabel:{showMinLabel:!1,rotate:45,margin:0,padding:10,align:"right",verticalAlign:"top"},splitNumber:10,name:E("app.map.timeSeriesDialog.xUnit"),nameLocation:g?"middle":"end",nameGap:g?-15:15},yAxis:{type:"value",scale:!0,name:null!==(t=null===(a=O[0])||void 0===a||null===(o=a.dataset)||void 0===o?void 0:o.unit)&&void 0!==t?t:"",nameTextStyle:{align:"center",padding:15}},dataZoom:[{type:"slider",height:40},{type:"inside"}],series:W};return(0,b.jsxs)(s.A,{sx:Da,children:[(0,b.jsxs)(s.A,{sx:Ra,children:[(0,b.jsx)(s.A,{sx:Ia,children:(0,b.jsxs)(Ye.A,{sx:{minWidth:200},size:"small",children:[(0,b.jsx)(Ba.A,{id:"SelectedModel",children:E("app.map.timeSeriesDialog.selectedModel")}),(0,b.jsx)(st.A,{labelId:"SelectedModel",id:"SelectedModel",value:R[0],label:E("app.map.timeSeriesDialog.selectedModel"),onChange:e=>F([e.target.value,R[1]]),children:L.map((e=>(0,b.jsx)(ct.A,{value:e,disabled:e===R[1],children:w(e,"forecast_models")})))})]})}),(0,b.jsx)(s.A,{sx:Ia,children:(0,b.jsxs)(Ye.A,{sx:{minWidth:200},size:"small",children:[(0,b.jsx)(Ba.A,{id:"SelectedModel",children:E("app.map.timeSeriesDialog.comparisonModel")}),(0,b.jsx)(st.A,{labelId:"SelectedModel",id:"SelectedModel",value:R[1],label:E("app.map.timeSeriesDialog.comparisonModel"),onChange:e=>F([R[0],e.target.value]),children:L.map((e=>(0,b.jsx)(ct.A,{value:e,disabled:e===R[0],children:w(e,"forecast_models")},e)))})]})}),(0,b.jsx)(s.A,{sx:Ia,children:(0,b.jsx)(Ye.A,{sx:{minWidth:120},size:"small",children:(0,b.jsx)(dt.A,{control:(0,b.jsx)(Ea.A,{checked:f,onChange:e=>y(e.target.checked),inputProps:{"aria-label":"controlled"}}),label:E("app.map.timeSeriesDialog.movingAverage")})})})]}),(null===O||void 0===O?void 0:O.length)>0?(0,b.jsx)(s.A,{sx:Oa,children:(0,b.jsx)(za.A,{ref:v,option:V,onEvents:{legendselectchanged:()=>{const e=Object.entries(v.current.getEchartsInstance().getOption().legend[0].selected).filter((e=>!e[1])).map((e=>e[0]));p(O.filter((t=>!e.includes("".concat(w(t.dataset.scenario_id,"scenarios")," - ").concat(w(t.dataset.forecast_model_id,"forecast_models"))))).map((e=>e.dataset.id)))},dataZoom:(e,t)=>{const{startValue:a,endValue:n}=t.getOption().dataZoom[0],i={start:M[0].values[a].time,end:M[0].values[n-1].time};m(i)}}})}):(0,b.jsx)(s.A,{sx:Na,children:(0,b.jsx)(r.A,{size:80})})]})};var Va=a(34691);const Za=e=>{var t;const{setOpen:a,latLng:l,ids:o,timeRange:c}=e,{t:d}=(0,i.B)(),p=G.getInstance(),m=(0,I.wA)(),u=ie(),[x,h]=n.useState(!1),[g,f]=n.useState(!0),[y,v]=(0,n.useState)({accept_disclaimer:!1,email:"",membership:"",name:"",public:!1});return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Ke.A,{xs:1}),(0,b.jsx)(Ke.A,{xs:22,children:l&&(0,b.jsxs)(s.A,{children:[(0,b.jsx)(Oe.A,{variant:"h6",align:"center",sx:Fa,children:d("app.map.timeSeriesDialog.DLTimeSeries")}),(0,b.jsx)(ba,{onChange:e=>{v({...y,...e})},onValidityChange:e=>{f(!e)}})]})}),(0,b.jsx)(Ke.A,{xs:1}),(0,b.jsx)(Ke.A,{xs:0,def:1}),(0,b.jsx)(Ke.A,{xs:24,def:11,sx:Ta,children:(0,b.jsx)(D.A,{disabled:g||x||!(null!==(t=o.current)&&void 0!==t&&t.length),color:"primary",variant:"contained",startIcon:x?(0,b.jsx)(r.A,{size:20}):(0,b.jsx)(nt.A,{}),onClick:()=>{var e,t;if(!l||!o)return void console.log(l,o);const a={...y,ids:o.current,latitude:l.lat,longitude:l.lng,start:null===c||void 0===c||null===(e=c.current)||void 0===e?void 0:e.start,end:null===c||void 0===c||null===(t=c.current)||void 0===t?void 0:t.end};h(!0),p.downloadTimeseries(a).then((e=>{(0,Va.saveAs)(e,"timeseries.zip")})).catch((e=>{console.log(e),m(u.actions.genericError({error:"app.error.dlTimeSeries"}))})).finally((()=>h(!1)))},children:d("app.map.timeSeriesDialog.DLCsv")})}),(0,b.jsx)(Ke.A,{xs:24,def:11,sx:La,children:(0,b.jsx)(D.A,{variant:"contained",color:"secondary",onClick:()=>a(!1),children:d("app.common.close")})}),(0,b.jsx)(Ke.A,{xs:0,def:1})]})},Ha=e=>{const{open:t=!1,setOpen:a,selectedPoint:l}=e,s=l?new f.LatLng(l.latlng.lat,l.latlng.lng):null,r=l?l.name:null,{timeserie:o}=(0,I.d4)(Pa),{t:c}=(0,i.B)(),d=(0,n.useRef)([]),p=(0,n.useRef)(),m=e=>{p.current=e};return(0,n.useEffect)((()=>{if(0===o.length)return;const e=o[0].values,t={start:e[0].time,end:e[e.length-1].time};m(t)}),[o]),(0,b.jsx)(Ht.A,{open:t,sx:Ca,children:(0,b.jsxs)(Ke.A,{container:!0,rowSpacing:0,columnSpacing:{xs:0},columns:{xs:24,def:24},sx:ka,children:[(0,b.jsx)(Ke.A,{xs:1}),(0,b.jsx)(Ke.A,{xs:22,children:(0,b.jsx)(Oe.A,{variant:"h6",sx:Sa,children:c("app.header.acronymMeaning")})}),(0,b.jsx)(Ke.A,{xs:1,sx:Ma,children:(0,b.jsx)(M.A,{color:"secondary","aria-label":c("app.common.close"),component:"label",onClick:()=>a(!1),children:(0,b.jsx)(lt.A,{fontSize:"large"})})}),(0,b.jsx)(Ke.A,{xs:1}),(0,b.jsx)(Ke.A,{xs:22,children:s&&(0,b.jsx)(Wa,{latLng:s,setIds:e=>d.current=e,setTimeRange:m,place:r})}),(0,b.jsx)(Ke.A,{xs:1}),(0,b.jsx)(Za,{setOpen:a,latLng:s,ids:d,timeRange:p})]})})};var qa=a(26689),Ga=a(7644),Ja=a(96319);const Ua=()=>{const{enqueueSnackbar:e,closeSnackbar:t}=(0,Ga.dh)();return{enqueueCSnackbar:(a,n)=>e(a,{action:e=>(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(M.A,{size:"small",onClick:()=>t(e),children:(0,b.jsx)(Ja.A,{})})}),...n})}};var Ya=a(87990);a(78855);const $a={fontFamily:"Titillium Web, Helvetica Neue, Helvetica, Arial, sans-serif"},Ka={fontFamily:"Titillium Web, Helvetica Neue, Helvetica, Arial, sans-serif",fontSize:"1.25rem",color:"rgb(22, 77, 54)"},Qa={color:"#ae6028"},Xa=()=>{const{t:e}=(0,i.B)();return(0,b.jsx)(Ya.aN,{children:(0,b.jsx)(Ya.aF,{theme:"light",type:"slim",style:$a,children:(0,b.jsxs)(Ya.aH,{children:[(0,b.jsx)(Ya.aG,{style:Ka,children:(0,b.jsx)("b",{className:"green",children:e("app.header.acronymMeaning")})}),(0,b.jsx)(Ya.aJ,{children:(0,b.jsx)(Ya.aI,{children:(0,b.jsxs)(Ya.a$,{children:[(0,b.jsx)(Ya.b0,{href:"/info",style:Qa,children:e("app.header.menu.info")}),(0,b.jsx)(Ya.b0,{href:"/privacy",style:Qa,children:e("app.header.menu.privacyPolicy")}),(0,b.jsx)(Ya.b0,{href:"/data",style:Qa,children:e("app.header.menu.dataPolicy")})]})})})]})})})};function en(e){const t=ie(),a=(0,I.wA)(),{t:m,i18n:u}=(0,i.B)(),x=(0,c.A)(),{enqueueCSnackbar:h}=Ua(),[g,y]=n.useState(!1),[v,j]=n.useState(!1),_=n.useRef(void 0),A=n.useRef(new f.LatLng(0,0,0)),{layers:w,selected_map:S,cities:C,forecast_parameters:k,error:D}=(0,I.d4)(Pa),[M,T]=(0,n.useState)(!1),[L,R]=(0,n.useState)(null),[F,O]=(0,n.useState)(null),N=(0,l.A)(x.breakpoints.down("def")),[z,B]=(0,qa.ok)(),E=e=>e.filter((e=>e)).join(" - "),P=(e,t)=>{var a,n,i;const l=S[e];let s="";return l&&(s=null===(a=k[t])||void 0===a||null===(n=a.find((e=>e.id===l)))||void 0===n?void 0:n.name),null!==(i=s)&&void 0!==i?i:""};(0,n.useEffect)((()=>(a(t.actions.loadParameters()),a(t.actions.loadLayers()),a(t.actions.loadCities()),()=>{console.log("Unmounting MapPage")})),[]),(0,n.useEffect)((()=>{let e={};z.forEach(((t,a)=>{ee.includes(a)&&"null"!==t&&""!==t&&(e[a]=t)})),Object.keys(e).length>0&&w.length>0?a(t.actions.setMap(e)):w.length>0&&a(t.actions.setMap(S)),0===w.length&&T(!0)}),[w]),(0,n.useEffect)((()=>{if(S.id){T(!1);const e={...Object.fromEntries(Object.entries(S).filter((e=>{let[t]=e;return ee.includes(t)}))),city:(null===L||void 0===L?void 0:L.name)||"",lat:(null===L||void 0===L?void 0:L.latlng.lat)||"",lng:(null===L||void 0===L?void 0:L.latlng.lng)||""};B(e)}}),[S,L]),(0,n.useEffect)((()=>{if(S.id){let e={id:S.id};L&&(e.lat=L.latlng.lat,e.lng=L.latlng.lng),a(t.actions.requestTimeserie(e))}else a(t.actions.setTimeserie([]))}),[S,L]),(0,n.useEffect)((()=>{z.get("city")&&z.get("lat")&&z.get("lng")?R({name:z.get("city")||"",label:z.get("city")||"",latlng:{lat:parseFloat(z.get("lat")),lng:parseFloat(z.get("lng"))}}):R(null)}),[C]),(0,n.useEffect)((()=>{D&&h(m(D),{variant:"error"}),a(t.actions.genericError({error:""}))}),[D]);const W={cropImageByInnerWH:!0,hidden:!0,domtoimageOptions:{cacheBust:!0},position:"topleft",screenName:"".concat(P("variable","variables")),hideElementsWithSelectors:[".leaflet-control",".leaflet-control-search",".leaflet-control-zoom",".leaflet-control-coordinates",".leaflet-bar-timecontrol",".leaflet-control-layers"],mimeType:"image/jpeg",caption:"".concat(P("variable","variables"),"\n- ").concat(E([P("forecast_model","forecast_models"),P("scenario","scenarios")]),"\n- ").concat(E([P("data_series","data_series"),P("value_type","value_types"),P("time_window","time_windows")]),"\n- ").concat(P("year_period","year_periods"),"\n      "),captionFontSize:15,captionFont:"Arial",captionColor:x.palette.success.contrastText,captionBgColor:x.palette.success.dark,captionOffset:5};return(0,b.jsxs)(s.A,{sx:d,children:[(0,b.jsx)(Xa,{}),(0,b.jsx)(Aa,{onDownloadMapImg:()=>{let e="";try{var t;e="yes"===S.data_series?new Date(null===(t=_.current.timeDimension)||void 0===t?void 0:t.getCurrentTime()).getFullYear().toString():""}catch(i){}y(!0);const a="".concat(N?S.variable:P("variable","variables"),"\n- ").concat(E([P("forecast_model","forecast_models"),P("scenario","scenarios")]),"\n- ").concat(E([P("data_series","data_series"),P("value_type","value_types"),P("time_window","time_windows")]),"\n- ").concat(P("year_period","year_periods"),"\n").concat(e?" - Anno ".concat(e):"","   \xa9 ARPAV - Arpa FVG"),n="Screenshot ".concat(P("variable","variables")," - ").concat(E([P("forecast_model","forecast_models"),P("scenario","scenarios")])," - ").concat(E([P("data_series","data_series"),P("value_type","value_types"),P("time_window","time_windows")])," - ").concat(P("year_period","year_periods")," ").concat(e?" Anno ".concat(e):"",".png");F.takeScreen("image",{captionFontSize:N?10:12,screenName:"".concat(P("variable","variables")),caption:a}).then((e=>{y(!1),(0,Va.saveAs)(e,n)})).catch((e=>{y(!1),console.error(e)}))}}),!M&&(0,b.jsx)(Ue,{onReady:e=>{_.current=e;const t=new wa.SimpleMapScreenshoter(W);t.addTo(_.current),O(t)},openCharts:e=>{A.current=e,j(!0)},setPoint:e=>{R(e)},selectedPoint:L}),M&&(0,b.jsx)(s.A,{sx:p,children:(0,b.jsx)(r.A,{size:80})}),(0,b.jsx)(Ha,{selectedPoint:L,open:v,setOpen:j}),(0,b.jsx)(o.A,{sx:{color:"#fff",zIndex:e=>e.zIndex.drawer+1},open:g,children:(0,b.jsx)(r.A,{color:"inherit",size:80})})]})}}}]);